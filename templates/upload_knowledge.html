<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>上传知识（PDF）</title>
  <link rel="stylesheet" href="/static/style.css">
</head>
<body>
  <h1>上传 SFBT 知识文档（PDF）</h1>
  <form id="uploadForm" action="/admin/upload_knowledge" enctype="multipart/form-data" method="post">
    <div class="form-group">
      <label for="title">标题（可选）</label>
      <input name="title" id="title" type="text" placeholder="例如：SFBT 介绍" />
    </div>
    <div class="form-group">
      <label class="required" for="file">选择 PDF 文件</label>
      <input type="file" id="file" name="file" accept="application/pdf" required />
      <span class="input-hint">仅支持 PDF，上传即会触发向量库重建。</span>
    </div>
    <button type="submit">上传并加入知识库</button>
  </form>
  <p id="uploadStatus" style="margin-top:12px;"></p>
  <p><a href="/admin/knowledge">返回知识列表</a> | <a href="/admin">后台首页</a></p>

  <script>
    const formEl = document.getElementById('uploadForm');
    const statusEl = document.getElementById('uploadStatus');
    formEl.addEventListener('submit', async (e) => {
      e.preventDefault();
      statusEl.textContent = '上传中...';
      try {
        const fd = new FormData(formEl);
        const res = await fetch('/api/admin/upload_knowledge', { method: 'POST', body: fd });
        if (!res.ok) throw new Error('HTTP ' + res.status);
        const data = await res.json();
        statusEl.textContent = '上传成功：' + (data.title || '已加入知识库');
        formEl.reset();
      } catch (err) {
        statusEl.textContent = '上传失败：' + (err.message || err);
      }
    });
  </script>
</body>
</html>
